class t{static SIZE=4;static TILE_PROBABILITY=.9;static WIN_TILE_VALUE=2048;constructor(t=null){this.score=0,this.status="idle",this.initialState=t?JSON.parse(JSON.stringify(t)):null,this.state=t?JSON.parse(JSON.stringify(t)):this.initializeBoard()}initializeBoard(){return Array.from({length:t.SIZE},()=>Array(t.SIZE).fill(0))}spawnTile(){let e=[];for(let s=0;s<t.SIZE;s++)for(let i=0;i<t.SIZE;i++)0===this.state[s][i]&&e.push({row:s,col:i});if(e.length>0){let{row:s,col:i}=e[Math.floor(Math.random()*e.length)];this.state[s][i]=Math.random()<t.TILE_PROBABILITY?2:4}}updateStatus(){if(this.state.some(e=>e.includes(t.WIN_TILE_VALUE))){this.status="win";return}this.canMove()||(this.status="lose")}canMove(){for(let e=0;e<t.SIZE;e++)for(let s=0;s<t.SIZE;s++)if(0===this.state[e][s]||e<t.SIZE-1&&this.state[e][s]===this.state[e+1][s]||s<t.SIZE-1&&this.state[e][s]===this.state[e][s+1])return!0;return!1}move(t){if("playing"!==this.status)return;let e=JSON.stringify(this.state);switch(t){case"left":this.state=this.slideLeft(this.state);break;case"right":this.state=this.slideRight(this.state);break;case"up":this.state=this.slideUp(this.state);break;case"down":this.state=this.slideDown(this.state)}JSON.stringify(this.state)!==e&&this.spawnTile(),this.updateStatus()}slideLeft(t){return t.map(t=>this.compressRow(t))}slideRight(t){return t.map(t=>this.compressRow(t.reverse()).reverse())}slideUp(t){return this.transpose(this.slideLeft(this.transpose(t)))}slideDown(t){return this.transpose(this.slideRight(this.transpose(t)))}compressRow(e){let s=e.filter(t=>0!==t);for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,this.score+=s[t],s[t+1]=0);return[...s=s.filter(t=>0!==t),...Array(t.SIZE-s.length).fill(0)]}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}moveLeft(){this.move("left")}moveRight(){this.move("right")}moveUp(){this.move("up")}moveDown(){this.move("down")}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}start(){"idle"===this.status&&(this.resetBoard(),this.status="playing",this.spawnTile(),this.spawnTile())}restart(){this.resetBoard(),this.status="idle"}resetBoard(){this.state=this.initialState?JSON.parse(JSON.stringify(this.initialState)):this.initializeBoard(),this.score=0}}const e=new t,{button:s,gameField:i,gameScore:r,messages:a}={button:document.querySelector(".button"),gameField:document.querySelector(".game-field"),gameScore:document.querySelector(".game-score"),messages:{lose:document.querySelector(".message-lose"),win:document.querySelector(".message-win"),start:document.querySelector(".message-start")}};function o(){(function(){let t=e.getState();i.querySelectorAll(".field-cell").forEach((e,s)=>{let i=t[Math.floor(s/4)][s%4];e.textContent=i||"",e.className=`field-cell${i?` field-cell--${i}`:""}`})})(),r.textContent=e.getScore(),function(){let t=e.getStatus();Object.entries(a).forEach(([e,s])=>{s.classList.toggle("hidden",e!==t)})}()}s.addEventListener("click",function(){let t="idle"===e.getStatus();e[t?"start":"restart"](),s.textContent=t?"Restart":"Start",s.classList.toggle("start",!t),s.classList.toggle("restart",t),o()}),document.addEventListener("keydown",function(t){if("playing"!==e.getStatus())return;t.preventDefault();let s={ArrowLeft:()=>e.moveLeft(),ArrowRight:()=>e.moveRight(),ArrowUp:()=>e.moveUp(),ArrowDown:()=>e.moveDown()};s[t.key]&&(s[t.key](),o())});
//# sourceMappingURL=index.23b1b398.js.map
